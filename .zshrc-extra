export EDITOR=vim

# disable the extremely annoying auto-correct
unsetopt correct_all

# command with a space (' ') before them will not be remembered in
# $HISTFILE, handy for secret commands
setopt HIST_IGNORE_SPACE


# seems to be necessary to make vim mode work right
# bindkey '^[[A' history-substring-search-up
# bindkey '^[[B' history-substring-search-down

# execute this to try to import any running ssh-agent sessions
ssh-reagent () {
    for agent in /tmp/ssh-*/agent.*; do
       export SSH_AUTH_SOCK=$agent
       if ssh-add -l 2>&1 > /dev/null; then
           echo "Found working SSH Agent:"
           ssh-add -l
           return
       fi
   done

   echo "Cannot find ssh agent - maybe you should reconnect and forward it?"
}

domain-from-url () {
    local url="$1"
    python -c "from urlparse import urlparse
if '$url'.find('://') == -1:
  url = urlparse('//$url','http')
else:
  url = urlparse('$url')
print url.netloc"
}

fetch-website () {
    local dom
    local url

    if [[ "$#" -eq 2 ]]; then
        url="$2"
        dom="$1"
    else
        url="$1"
        dom=$(domain-from-url $url)
    fi

    wget \
         --recursive \
         --no-clobber \
         --page-requisites \
         --html-extension \
         --convert-links \
         --restrict-file-names=windows \
         --domains "$dom" \
         --no-parent \
         "$url"
}
